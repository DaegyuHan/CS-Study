# IP 주소

## ARP (Address Resolution Protocol)

- 컴퓨터와 컴퓨터 간의 통신은 **IP 주소에서 ARP를 통해 MAC 주소를 찾아 MAC 주소를 기반으로 통신**한다.
- ARP란 IP와 MAC 주소의 다리 역할을 하는 프로토콜.
- ARP를 통해 가상 주소인 IP 주소를 실제 주소인 MAC 주소로 변환.
- RARP를 통해 실제 주소인 MAC 주소를 가상 주소인 IP 주소로 변환.

<br>
<img src="https://thebook.io/img/080326/106.jpg" style="width:400px; padding-left:10px;">
<br>

> 장치 A가 ARP Request 브로드캐스트를 보내서 IP 주소인 127.70.80.3에 해당하는 MAC 주소를 찾는다. 그 후 해당 주소에 맞는 장치 B가 ARP Reply 유니캐스트를 통해 MAC 주소를 반환하는 과정을 거쳐 IP 주소에 맞는 MAC 주소를 찾게 된다.  
> 
> \* *브로드캐스트 : 송신 호스트가 전송한 데이터가 네트워크에 연결된 모든 호스트에 전송되는 방식*   
> \* *유니캐스트 : 고유 주소로 식별된 하나의 네트워크 목적지에 1:1로 데이터를 전송하는 방식식*


## 홉바이홉 통신

IP 주소를 통해 통신하는 과정을 홉바이홉 통신이라고 하며, 여기서 홉(hop)이란 통신망에서 각 패킷이 여러 개의 라우터를 건너가는 모습을 비유적으로 표현한 것이다. **수많은 서브네트워크 안에 있는 라우터의 라우팅 테이블 IP를 기반으로 패킷을 전달하고 또 전달해나가며 라우팅을 수행해 최종 목적지까지 패킷을 전달**한다.

<br>
<img src="https://blog.kakaocdn.net/dn/bQta2W/btskuPLZoc1/lQRLvu1EdR4QVJhtmUMgUK/img.jpg" style="width:400px; padding-left:10px;">
<br>

즉, 통신 장치에 있는 라우팅 테이블의 IP를 통해 시작 주소부터 시작하여 다음 IP로 계속해서 이동하는 라우팅 과정을 거쳐 패킷이 최종 목적지까지 도달하는 통신을 말한다.
> \* 라우팅 : IP 주소를 찾아가는 과정

### 라우팅 테이블 (Routing table)

- 송신지에서 수신지까지 도달하기 위해 사용.
- 라우터에 들어가 있는 **목적지 정보들**과 그 목적지로 가기 위한 **방법**이 들어 있는 리스트.
  - 게이트 웨이.
  - 모든 목적지에 대해 해당 목적지에 도달하기 위해 거쳐야 할 다음 라우터의 정보.

### 게이트웨이 (Gateway)

게이트웨이는 **서로 다른 통신망, 프로토콜을 사용하는 네트워크 간의 통신을 가능하게 하는 관문 역할**을 하는 컴퓨터나 소프트웨어를 두루 일컫는 용어이다.

- 사용자는 인터넷에 접속하기 위해 수많은 게이트웨이 거쳐야 함.
- 서로 다른 네트워크상의 통신 프로토콜을 변환해주는 역할 하기도 함.
- 윈도우 명령 프롬프트에서 `netstat -r` 명령어 실행하여 확인 가능.


## IP 주소 체계

- **IPv4**

  - 주소 체계: 32비트 주소.
    - 약 43억 개의 고유 IP 주소 제공 (2³² = 4,294,967,296).
  - 표기 방식: 점으로 구분된 10진수 표기.
    - 예: 192.168.0.1.
  - 주소 고갈 문제: 네트워크와 인터넷 사용 증가로 인해 IP 주소 고갈 문제 발생.
    - 해결 방법: NAT(Network Address Translation) 사용으로 공용 IP를 공유.
  - 헤더 구조: 단순하고 크기가 작음(20~60바이트).
  - 보안: IPsec은 선택 사항으로 구현.
  - 브로드캐스트 지원: 특정 네트워크의 모든 호스트로 데이터를 전송.
  - 모바일 지원: 이동성 지원이 제한적.

- **IPv6**

  - 주소 체계: 128비트 주소.
    - 약 3.4 × 10³⁸ 개의 주소 제공 (2¹²⁸).
    - 사실상 무한한 IP 주소 제공.
  - 표기 방식: 콜론으로 구분된 16진수 표기.
    - 예: 2001:0db8:85a3:0000:0000:8a2e:0370:7334.
    - 연속된 0은 ::로 압축 가능.
    - 압축된 예: 2001:db8::8a2e:370:7334.
  - 주소 구분:
    - 유니캐스트(단일 대상), 멀티캐스트(다중 대상), 애니캐스트(가장 가까운 대상).
  - 헤더 구조: 단순화된 고정 크기(40바이트)로 처리 효율성 향상.
  - 보안: IPsec이 필수적으로 내장.
  - 브로드캐스트 제거: 대신 멀티캐스트 사용.
  - 모바일 지원: 네이티브 이동성 지원.
  - 추가 기능:
    - 자동 주소 구성(SLAAC).
    - 향상된 라우팅 및 QoS 지원.

### 클래스 기반 할당 방식 (Classful network addressing)

- A, B, C, D, E 다섯 개의 클래스로 구분.

<img src="https://thebook.io/img/080326/110_1.jpg" style="width:400px; padding-left:10px;"> 
<br>

- 클래스 A, B, C : 일대일 통신
- 클래스 D : 멀티캐스트 통신
- 클래스 E : 예비용

<img src="https://thebook.io/img/080326/110_2.jpg" style="width:400px; padding-left:10px;"> 
<br>

- 맨 왼쪽에 있는 비트 : 구분 비트
  - A - 0
  - B - 10
  - C - 110
- 네트워크의 첫 번째 주소 : 네트워크 주소
- 가장 마지막 주소 : 브로드캐스트용 주소, 네트워크에 속해 있는 모든 컴퓨터에 데이터 보낼 때 사용.
- 만약 클래스 A로 `12.0.0.0`이란 네트워크를 부여받았다면 첫 번째 주소와 마지막 주소를 제외한 `12.0.0.1~12.255.255.254`를 컴퓨터에 부여하는 호스트 주소로 사용 가능.
- 주소 낭비의 단점 존재, 이를 극복하기 위해 DHCP와 IPv6, NAT 등장.

<br>
<img src="https://thebook.io/img/080326/111.jpg" style="width:400px; padding-left:10px;"> 
<br>

### DHCP (Dynamic Host Configuration Protocol)

- IP 주소 및 기타 통신 매개변수를 자동으로 할당하기 위한 네트워크 관리 프로토콜.
- 네트워크 장치 IP 주소 수동 설정할 필요 없이 인터넷에 접속할 때마다 자동으로 할당 가능.
- 대부분의 가정용 네트워크에서 사용 중.

### NAT (Network Address Translation)

NAT는 패킷이 라우팅 장치를 통해 전송되는 동안 패킷의 IP 주소 정보를 수정하여 **IP 주소를 다른 주소로 매핑**하는 방법이다. IPv4 주소 체계만으로는 많은 주소들을 모두 감당하지 못하는 단점이 있는데 이를 해결하기 위해 NAT로 **공인 IP와 사설 IP**로 나눠서 많은 주소를 처리한다. NAT를 가능하게 하는 소프트웨어는 *ICS*, *RRAS*, *Metfilter* 등이 있다.

<img src="https://thebook.io/img/080326/112.jpg" style="width:400px; padding-left:10px;"> 
<br>

> 위의 그림에서 가영 대리, 홍철 팀장처럼 `192.168.0.xxx`를 기반으로 각각의 다른 IP들을 **사설 IP**라고 하고 NAT 장치를 통해 하나의 IP로 외부 인터넷에 요청하는 `121.165.151.200`은 **공인 IP**라고 한다.  
> 이를 통해 어비스 회사에 있는 가영 대리와 홍철 팀장은 하나의 IP인 `121.165.151.200`을 기반으로 각각의 다른 IP들을 가지는 것처럼 인터넷을 사용할 수 있다. 이처럼 NAT 장치를 통해 **사설 IP를 공인 IP로 변환하거나 공인 IP를 사설 IP로 변환**하는데 사용한다.

#### 공유기와 NAT

NAT를 쓰는 이유는 주로 **여러 대의 호스트가 하나의 공인 IP 주소를 사용하여 인터넷에 접속**하기 위함이다. 인터넷 회선 하나를 개통하고 인터넷 공유기를 달아서 여러 PC를 연결하여 사용할 수 있는 것이 가능한 이유도 인터넷 공유기에 NAT 기능이 탑재되어 있기 때문이다.

#### NAT를 이용한 보안

NAT 사용시 내부 네트워크에서 사용하는 IP 주소와 외부에 드러나는 IP 주소를 다르게 유지할 수 있기 때문에 내부 네트워크에 대한 일정 수준의 보안이 가능해진다.

#### NAT의 단점
여러 명이 동시에 인터넷을 접속하게 되므로 실제로 접속하는 호스트 숫자에 따라 접속 속도가 느려질 수 있다.

### IP 주소를 이용한 위치 정보
IP 주소는 인터넷에서 사용하는 네트워크 주소이기 때문에 이를 통해 동 또는 구까지 위치 추적이 가능하다. 다음 사이트로 IP 주소를 기반으로 위치를 찾을 수 있다.

> <a href="https://mylocation.co.kr/">mylocation 사이트 링크</a>
